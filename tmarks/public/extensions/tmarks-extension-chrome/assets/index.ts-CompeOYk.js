(function(){class s{extract(){return{title:this.getTitle(),url:window.location.href,description:this.getDescription(),content:this.getMainContent(),thumbnail:this.getThumbnail()}}getTitle(){return document.title||this.getMeta("og:title")||document.querySelector("h1")?.textContent?.trim()||"Untitled"}getDescription(){return this.getMeta("description")||this.getMeta("og:description")||this.getMeta("twitter:description")||""}getMainContent(){const e=document.querySelector("article")||document.querySelector("main")||document.querySelector('[role="main"]')||document.body;if(!e)return"";const t=e.cloneNode(!0);return t.querySelectorAll("script, style, nav, header, footer, iframe, noscript").forEach(o=>{o.remove()}),(t.textContent||"").replace(/\s+/g," ").trim().substring(0,1e3)}getThumbnail(){const e=document.querySelector('meta[property="og:image"]');if(e instanceof HTMLMetaElement&&e.content)try{return new URL(e.content,window.location.href).href}catch(o){console.error("Failed to parse og:image URL:",o)}const t=document.querySelector('meta[name="twitter:image"]');if(t instanceof HTMLMetaElement&&t.content)try{return new URL(t.content,window.location.href).href}catch(o){console.error("Failed to parse twitter:image URL:",o)}const r=document.querySelector("main")||document.querySelector('[role="main"]')||document.querySelector("article")||document.body;if(r){const o=r.querySelectorAll("img");let c=null,a=0;for(const n of o)if(n.src&&n.naturalWidth>200&&n.naturalHeight>200){const l=n.naturalWidth*n.naturalHeight;l>a&&(a=l,c=n)}if(c&&c.src)try{return new URL(c.src,window.location.href).href}catch(n){console.error("Failed to parse largest image URL:",n)}}return""}getMeta(e){return(document.querySelector(`meta[name="${e}"]`)||document.querySelector(`meta[property="${e}"]`))?.getAttribute("content")||""}}const u=new s;chrome.runtime.onMessage.addListener((i,e,t)=>{if(console.log("[ContentScript] Received message:",i.type),i.type==="EXTRACT_PAGE_INFO"){try{const r=u.extract();console.log("[ContentScript] Successfully extracted page info:",r),t({success:!0,data:r})}catch(r){console.error("[ContentScript] Failed to extract page info:",r),t({success:!1,error:r instanceof Error?r.message:"Unknown error"})}return!0}});console.log("[AITmarks] Content script loaded");
})()
